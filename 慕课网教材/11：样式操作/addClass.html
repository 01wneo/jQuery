
<!doctype html>
<html>
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8"/>

	 <style>
		  .p { margin: 4px; font-size:16px; font-weight:bolder; }
		  .blue { color:blue; }
		  .under { text-decoration:underline; }
		  .highlight { background:yellow; }
	 </style>
	 <!-- // <script src="http://code.jquery.com/jquery-latest.js"></script> -->
	 <script type="text/javascript" src="../jquery-2.1.1.js"></script>
	<title></title>
</head>
<body>

<p class="">Goodbye</p>

<script type="text/javascript">
	
	var p = $("p");

	p.addClass("blue").addClass("highlight").addClass('under')

    function addClass(value) {
    	var classes, elem, cur, clazz, j,
    		i = 0,
    		len = this.length,
    		proceed = typeof value === "string" && value;

    	//如果传递的是回调函数，递归调用  ⑴
    	if (jQuery.isFunction(value)) {
    		return this.each(function(j) {
    			jQuery(this).addClass(value.call(this, j, this.className));
    		});
    	}

    	if (proceed) {
    		// The disjunction here is for better compressibility (see removeClass)
    		//分解下样式规则,通过正则/\S+/g 空白分组
    		// classes [
    		//    0: "highlight"
    		// ]                               ⑵
    		classes = (value || "").match(core_rnotwhite) || [];

    		for (; i < len; i++) {
    			elem = this[i];
    			//如果元素本身存在class样式，先取出来     ⑷
    			cur = elem.nodeType === 1 && (elem.className ?
    				("" + elem.className + "").replace(rclass, "") :
    				""
    			);

    			if (cur) { //组合成新的规则按照空格分开  ⑸
    				j = 0;
    				while ((clazz = classes[j++])) {
    					if (cur.indexOf("" + clazz + "") < 0) {
    						cur += clazz + "";
    					}
    				}
    				//设置样式  ⑹
    				elem.className = jQuery.trim(cur);

    			}
    		}
    	}
    	return this;
    }

</script>
</body>
</html>