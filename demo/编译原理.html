<!doctype html>
<html>
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
	<title>参考对照学习</title>

	 <!-- // <script src="jquery-1.11.1.js"></script> -->
	 <script src="core.js"></script>
	 <script src="sizzle.js"></script>
	 <script src="other.js"></script>
	<style type="text/css">
		ul.topnav > li{
			border: 1px solid
		}
	</style>
</head>
<body>

<div id="text">
  <div class="Aaron">
     <input type="checkbox" name="readme" />
     <input type="checkbox" name="ttt" />
     <input type="checkbox" name="aaa" />
     <p>Sizzle</p>
  </div>
</div>


<!--   <form>
 
  <label>Name:</label>
  <input name="name" />
  <fieldset>
    <label>Newsletter:</label>
 
    <input name="newsletter" />
  </fieldset>
</form>
<input name="none" /> -->



	<script type="text/javascript">


	//tokenize("div > div.Aaron input[name=ttt]");

	// console.log($("#prev ~ div"))

	// console.log($("label + input"))
	console.log( $('Aaron input[name=ttt]') )



var filter = {
	ATTR: function(name, operator,check) {
		return function(elem) {
			var attr = elem.getAttribute(name)
			if (operator === "=") {
				if(attr === check){
					return true
				}
			}
			return false;
		}
	},
	TAG: function(nodeNameSelector) {
		return function(elem) {
			return elem.nodeName && elem.nodeName.toLowerCase() === nodeNameSelector;
		};
	}
}

function addCombinator(matcher) {
	return function(elem, context, xml) {
		while ((elem = elem['parentNode'])) {
			if (elem.nodeType === 1) {
				//找到第一个亲密的节点，立马就用终极匹配器判断这个节点是否符合前面的规则
				return matcher(elem);
			}
		}
	}
}


function elementMatcher(matchers) {
	return matchers.length > 1 ?
	function(elem, context, xml) {
		var i = matchers.length;
		while (i--) {
			if (!matchers[i](elem, context, xml)) {
				return false;
			}
		}
		return true;
	} :
	//单个匹配器的话就返回自己即可
	matchers[0];
}



function matcherFromTokens(tokens){
	var len = tokens.length;
	var matcher, matchers = [];
	for (i = 0; i < len; i++) {
		if (tokens[i].type === " ") {
			matchers = [addCombinator(elementMatcher(matchers), matcher)];
		} else {
			matcher = filter[tokens[i].type].apply(null, tokens[i].matches);
			matchers.push(matcher);
		}
	}
	return elementMatcher(matchers);
}


function compile() {
	//种子合集
	var seed = document.querySelectorAll('input')
	//选择器
	var selector = "Aaron [name=ttt]";
	var elementMatchers = [];
	var results = []
	var match = [{
		matches: ["div"],
		type: "TAG",
		value: "Aaron"
	}, {
		type: " ",
		value: " "
	}, {
		matches: ["name", "=", "ttt"],
		type: "ATTR",
		value: "[name=ttt]"
	}]
	elementMatchers.push(matcherFromTokens(match));
	var matcher, elem;
	for (var i = 0; i < seed.length; i++) {
		matcher = elementMatchers[0];
		var elem = seed[i];
		if (matcher(elem)) {
			results.push(elem);
			break;
		}
	}
	console.log(results)
}


compile();


	// console.log($("ul.topnav > li"))

		// dfd.done(function(aa) {
		// 	console.log(aa)
		// 	return aa * 2
		// })

		// dfd.then(function(aa) {
		// 	console.log(aa)
		// 	return aa * 2
		// }).then(function(aa) {
		// 	console.log(aa)
		// 	return aa * 2
		// })


		// dfd.resolve(2)

		// setTimeout(function() {
		// 	dfd.done(function(aa) {
		// 		console.log(aa)
		// 		return aa * 2
		// 	})
		// }, 1000)


		// function fn1(value) {
		// 	console.log("fn1 says: " + value);
		// 	return false;
		// }

		// function fn2(value) {
		// 	console.log("fn2 says: " + value);
		// 	return false;
		// }

		// var callbacks = $.Callbacks('memory');

		// callbacks.add(fn1);  //1
		// callbacks.fire("foo");
		// callbacks.add(fn2);  //2
		// callbacks.fire("baz");
		// callbacks.remove(fn2);


		// var body = $("body");
		// //设置值		
		// body.data("foo", 52);

		// //带key对象
		// body.data("bar", {
		// 	myType : "test",
		// 	count  : 40
		// });

		// //直接对象
		// body.data({
		// 	baz: [1, 2, 3]
		// });
		 
		// //取值
		// console.log( body.data("bar") )

	</script>

</body>
</html>